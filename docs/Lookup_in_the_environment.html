<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>4&nbsp;Lookup in the environment</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Make your own meta-<wbr></wbr>circular evaluator!</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Meta-circular_what_.html" class="tocviewlink" data-pltdoc="x">Meta-<wbr></wbr>circular what?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Some_Racket.html" class="tocviewlink" data-pltdoc="x">Some Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Fixing_the_calculator.html" class="tocviewlink" data-pltdoc="x">Fixing the calculator</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Lookup in the environment</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Definitions.html" class="tocviewlink" data-pltdoc="x">Definitions</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Functions.html" class="tocviewlink" data-pltdoc="x">Functions</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Continuation-passing_style.html" class="tocviewlink" data-pltdoc="x">Continuation-<wbr></wbr>passing style</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Refactoring_to_CPS.html" class="tocviewlink" data-pltdoc="x">Refactoring to CPS</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Booleans.html" class="tocviewlink" data-pltdoc="x">Booleans</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Ambiguousness.html" class="tocviewlink" data-pltdoc="x">Ambiguousness</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="It_s_puzzle_time.html" class="tocviewlink" data-pltdoc="x">It&rsquo;s puzzle time</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Towards_zebras.html" class="tocviewlink" data-pltdoc="x">Towards zebras</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>4&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Lookup in the environment</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">4.1&nbsp;</td><td><a href="#%28part._lookup-tests%29" class="tocviewlink" data-pltdoc="x">Some tests</a></td></tr><tr><td align="right">4.2&nbsp;</td><td><a href="#%28part._.An_environment%29" class="tocviewlink" data-pltdoc="x">An environment</a></td></tr><tr><td align="right">4.3&nbsp;</td><td><a href="#%28part._primitives%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">primitives</span></a></td></tr><tr><td align="right">4.4&nbsp;</td><td><a href="#%28part._lookup%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">lookup</span></a></td></tr><tr><td align="right">4.5&nbsp;</td><td><a href="#%28part._.Environment_as_input_to_eval-exp%29" class="tocviewlink" data-pltdoc="x">Environment as input to <span class="RktSym">eval-<wbr></wbr>exp</span></a></td></tr><tr><td align="right">4.6&nbsp;</td><td><a href="#%28part._lookup-done%29" class="tocviewlink" data-pltdoc="x">Done?</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._lookup-tests%29" class="tocsubseclink" data-pltdoc="x">Some tests</a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.An_environment%29" class="tocsubseclink" data-pltdoc="x">An environment</a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._primitives%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">primitives</span></a></td></tr><tr><td><span class="tocsublinknumber">4.4<tt>&nbsp;</tt></span><a href="#%28part._lookup%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">lookup</span></a></td></tr><tr><td><span class="tocsublinknumber">4.5<tt>&nbsp;</tt></span><a href="#%28part._.Environment_as_input_to_eval-exp%29" class="tocsubseclink" data-pltdoc="x">Environment as input to <span class="RktSym">eval-<wbr></wbr>exp</span></a></td></tr><tr><td><span class="tocsublinknumber">4.5.1<tt>&nbsp;</tt></span><a href="#%28part._.Looking_up%29" class="tocsubseclink" data-pltdoc="x">Looking up</a></td></tr><tr><td><span class="tocsublinknumber">4.5.2<tt>&nbsp;</tt></span><a href="#%28part._eval-application%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">eval-<wbr></wbr>application</span></a></td></tr><tr><td><span class="tocsublinknumber">4.6<tt>&nbsp;</tt></span><a href="#%28part._lookup-done%29" class="tocsubseclink" data-pltdoc="x">Done?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">6.12</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Fixing_the_calculator.html" title="backward to &quot;3 Fixing the calculator&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Definitions.html" title="forward to &quot;5 Definitions&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>4<tt>&nbsp;</tt><a name="(part._.Lookup_in_the_environment)"></a>Lookup in the environment</h3><p>If we&rsquo;ve been through the previous part, we can keep using the same file. Or we can use <span class="stt">1-fixed-calculator.rkt</span> as our starting point.</p><p>We see that most of the match-clauses in <span class="RktSym">eval-exp</span> look quite similar.
We will do some steps of refactoring in order to not repeat ourselves, and also to be prepared for things to come.
Later the users of the program will be able to define their own variables with names they choose themselves,
so we do not want to continue to match on the names (<span class="RktVal">'</span><span class="RktVal">+</span>, <span class="RktVal">'</span><span class="RktVal"><span class="nobreak">-</span></span> and so on) as we currently do in <span class="RktSym">eval-exp</span>.
Instead we will look up the values of variables in some lookup-table that can be extended dynamically.</p><h4>4.1<tt>&nbsp;</tt><a name="(part._lookup-tests)"></a>Some tests</h4><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">b</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-exn</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">exn:fail?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">c</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h4>4.2<tt>&nbsp;</tt><a name="(part._.An_environment)"></a>An environment</h4><p>Idea is: Whenever we evaluate an expression, we will have an environment with bound variables and their values,
and when we evaluate a variable reference, we will look up its value in the environment.</p><p>An environment can look like:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">5</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">4</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">c</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">. </span><span class="RktVal">7</span><span class="RktVal">)</span><span class="RktVal">)</span></p></blockquote><p>In this environment, looking up <span class="RktVal">'</span><span class="RktVal">b</span> should give us <span class="RktVal">4</span> and <span class="RktVal">'</span><span class="RktVal">c</span> should give us <span class="RktVal">3</span>.
<span class="RktVal">'</span><span class="RktVal">a</span> should give us <span class="RktVal">5</span>. New bindings are added to the beginning of the list, and newer bindings shadow older ones.
We can&rsquo;t reach the <span class="RktVal">'</span><span class="RktVal">a</span> that is bound to <span class="RktVal">7</span>.</p><h4>4.3<tt>&nbsp;</tt><a name="(part._primitives)"></a><span class="RktSym">primitives</span></h4><p><div class="SIntrapara">We will start off by making a list called <span class="RktSym">primitives</span> containing our four primitive operators,
and look up in this list every time the function <span class="RktSym">eval-exp</span> sees a symbol.
We will use <span class="RktSym">list</span> to construct the list of bindings.
Each binding will be a pair, constructed with <span class="RktSym">cons</span>.</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">primitives</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-style: italic">more bindings</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>4.4<tt>&nbsp;</tt><a name="(part._lookup)"></a><span class="RktSym">lookup</span></h4><p>We will implement this as a recursive function.
If the first binding in the list is equal to the symbol we are looking for then we return the corresponding value,
otherwise we call lookup on what remains of the list.
If the list is empty it doesn&rsquo;t have the binding we&rsquo;re looking for, and we will raise an exception.</p><p><div class="SIntrapara">We will make the <span class="RktSym">lookup</span>-function:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="hspace">&nbsp;</span><span class="RktSym">s</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-style: italic">your code here</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>It should have a couple of match-clauses:</p><p><div class="SIntrapara">One should match the empty list (e.g. <span class="RktPn">(</span><span class="RktSym">list</span><span class="RktPn">)</span> or <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span>), and throw an exception.
We can use Racket&rsquo;s <span class="RktSym">error</span>-function to raise an exception
(see the function <span class="RktSym">eval-exp</span> for an example of use of <span class="RktSym">error</span>).</div><div class="SIntrapara">The more difficult part is to match a list with a binding (a <span class="RktSym">cons</span>-pair) as its first element.
We can use a clause like:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">val</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span style="font-style: italic">your code here</span><span class="RktPn">]</span></p></blockquote></div><div class="SIntrapara">If this matches it will pick out the parts we need:
<span class="RktSym">name</span> will be bound to a variable name and <span class="RktSym">val</span> to its value,
and <span class="RktSym">rest</span> will be bound to the rest of the list.
We then want to check <span class="RktSym">if</span> <span class="RktSym">name</span> is <span class="RktSym">equal?</span> to <span class="RktSym">s</span>,
and return <span class="RktSym">val</span> if it is,
or else call lookup on <span class="RktSym">s</span> and the <span class="RktSym">rest</span> of the list.</div></p><p>The tests we added should pass when we&rsquo;re done.</p><h4>4.5<tt>&nbsp;</tt><a name="(part._.Environment_as_input_to_eval-exp)"></a>Environment as input to <span class="RktSym">eval-exp</span></h4><p>We will pass <span class="RktSym">primitives</span> as an argument to <span class="RktSym">eval-exp</span>, and make <span class="RktSym">eval-exp</span> use it to look up values.
So, in the definition of <span class="RktSym">eval-exp</span>, instead of</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span></p></blockquote><p>we will have have</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span></p></blockquote><p><span class="RktSym">env</span> will be the list of bindings we will use for looking up stuff.</p><p>We should modify the <span class="RktSym">evaluate</span>-function so that it passes <span class="RktSym">primitives</span> along to <span class="RktSym">eval-exp</span>.</p><h5>4.5.1<tt>&nbsp;</tt><a name="(part._.Looking_up)"></a>Looking up</h5><p><div class="SIntrapara">Now that <span class="RktSym">eval-exp</span> has an <span class="RktSym">env</span>ironment we can use it for when there are symbols:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym">symbol?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span style="font-style: italic">your code here</span><span class="RktPn">]</span></p></blockquote></div></p><p>When this matches we want to apply our <span class="RktSym">lookup</span>-function to <span class="RktSym">env</span> and <span class="RktSym">exp</span>.</p><h5>4.5.2<tt>&nbsp;</tt><a name="(part._eval-application)"></a><span class="RktSym">eval-application</span></h5><p>Now, instead of having different match-clauses for <span class="RktVal">'</span><span class="RktVal">+</span> and <span class="RktVal">'</span><span class="RktVal"><span class="nobreak">-</span></span> and so on,
we can have one clause for function application:</p><blockquote class="SCodeFlow"><p><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktSym">fun</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-application</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="hspace">&nbsp;</span><span class="RktSym">fun</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">]</span></p></blockquote><p>We should be able to evaluate the <span class="RktSym">fun</span>-expression to get the correct function.
We&rsquo;re using a helper function:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-application</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="hspace">&nbsp;</span><span class="RktSym">fun</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span style="font-style: italic">your code here</span><span class="RktPn">)</span></td></tr></table></blockquote><p>It should evaluate the <span class="RktSym">fun</span>-expression and all the expressions in the <span class="RktSym">args</span> list,
and <span class="RktSym">apply</span> the evaluated  <span class="RktSym">fun</span> to the evaluated <span class="RktSym">args</span>.</p><p>Should be pretty similar to what we used to do when we matched e.g. <span class="RktVal">'</span><span class="RktVal">+</span>,
only we don&rsquo;t use a hardcoded function (like <span class="RktSym">+</span>),
and we need to pass the <span class="RktSym">env</span>ironment along whenever we call <span class="RktSym">eval-exp</span>.</p><h4>4.6<tt>&nbsp;</tt><a name="(part._lookup-done)"></a>Done?</h4><p><div class="SIntrapara">Run and see that all the tests pass.</div><div class="SIntrapara">Next is <a href="Definitions.html" data-pltdoc="x">Definitions</a>.
We can keep using the Racket-file we&rsquo;re working with, or skip to <span class="stt">2-lookup-in-environment.rkt</span>.</div></p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Fixing_the_calculator.html" title="backward to &quot;3 Fixing the calculator&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Definitions.html" title="forward to &quot;5 Definitions&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>