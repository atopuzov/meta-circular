<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>10&nbsp;Ambiguousness</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Make your own meta-<wbr></wbr>circular evaluator!</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Meta-circular_what_.html" class="tocviewlink" data-pltdoc="x">Meta-<wbr></wbr>circular what?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Some_Racket.html" class="tocviewlink" data-pltdoc="x">Some Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Fixing_the_calculator.html" class="tocviewlink" data-pltdoc="x">Fixing the calculator</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Lookup_in_the_environment.html" class="tocviewlink" data-pltdoc="x">Lookup in the environment</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Definitions.html" class="tocviewlink" data-pltdoc="x">Definitions</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Functions.html" class="tocviewlink" data-pltdoc="x">Functions</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Continuation-passing_style.html" class="tocviewlink" data-pltdoc="x">Continuation-<wbr></wbr>passing style</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Refactoring_to_CPS.html" class="tocviewlink" data-pltdoc="x">Refactoring to CPS</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Booleans.html" class="tocviewlink" data-pltdoc="x">Booleans</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Ambiguousness</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="It_s_puzzle_time.html" class="tocviewlink" data-pltdoc="x">It&rsquo;s puzzle time</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Towards_zebras.html" class="tocviewlink" data-pltdoc="x">Towards zebras</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>10&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Ambiguousness</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">10.1&nbsp;</td><td><a href="#%28part._amb-tests%29" class="tocviewlink" data-pltdoc="x">Some tests</a></td></tr><tr><td align="right">10.2&nbsp;</td><td><a href="#%28part._.Some_stuff_will_have_a_fail-parameter%29" class="tocviewlink" data-pltdoc="x">Some stuff will have a <span class="RktSym">fail</span>-<wbr></wbr>parameter</a></td></tr><tr><td align="right">10.3&nbsp;</td><td><a href="#%28part._require%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">require</span></a></td></tr><tr><td align="right">10.4&nbsp;</td><td><a href="#%28part._amb%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">amb</span></a></td></tr><tr><td align="right">10.5&nbsp;</td><td><a href="#%28part._.Btw_let_s_add_a_list-function_to_our_primitives%29" class="tocviewlink" data-pltdoc="x">Btw let&rsquo;s add a <span class="RktSym">list</span>-<wbr></wbr>function to our <span class="RktSym">primitives</span></a></td></tr><tr><td align="right">10.6&nbsp;</td><td><a href="#%28part._evaluate_%29" class="tocviewlink" data-pltdoc="x"><span class="RktSym">evaluate*</span></a></td></tr><tr><td align="right">10.7&nbsp;</td><td><a href="#%28part._amb-done%29" class="tocviewlink" data-pltdoc="x">Done?</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">10.1<tt>&nbsp;</tt></span><a href="#%28part._amb-tests%29" class="tocsubseclink" data-pltdoc="x">Some tests</a></td></tr><tr><td><span class="tocsublinknumber">10.2<tt>&nbsp;</tt></span><a href="#%28part._.Some_stuff_will_have_a_fail-parameter%29" class="tocsubseclink" data-pltdoc="x">Some stuff will have a <span class="RktSym">fail</span>-<wbr></wbr>parameter</a></td></tr><tr><td><span class="tocsublinknumber">10.3<tt>&nbsp;</tt></span><a href="#%28part._require%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">require</span></a></td></tr><tr><td><span class="tocsublinknumber">10.4<tt>&nbsp;</tt></span><a href="#%28part._amb%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">amb</span></a></td></tr><tr><td><span class="tocsublinknumber">10.5<tt>&nbsp;</tt></span><a href="#%28part._.Btw_let_s_add_a_list-function_to_our_primitives%29" class="tocsubseclink" data-pltdoc="x">Btw let&rsquo;s add a <span class="RktSym">list</span>-<wbr></wbr>function to our <span class="RktSym">primitives</span></a></td></tr><tr><td><span class="tocsublinknumber">10.6<tt>&nbsp;</tt></span><a href="#%28part._evaluate_%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">evaluate*</span></a></td></tr><tr><td><span class="tocsublinknumber">10.7<tt>&nbsp;</tt></span><a href="#%28part._amb-done%29" class="tocsubseclink" data-pltdoc="x">Done?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">6.12</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Booleans.html" title="backward to &quot;9 Booleans&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="It_s_puzzle_time.html" title="forward to &quot;11 It's puzzle time&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>10<tt>&nbsp;</tt><a name="(part._.Ambiguousness)"></a>Ambiguousness</h3><p>If we&rsquo;ve been through the previous part, we can keep using the same file. Or we can use <span class="stt">6-booleans.rkt</span> as our starting point.</p><p><div class="SIntrapara">Now that we have continuations, we will add continuations.</div><div class="SIntrapara">We want to add support for the new forms <span class="RktSym">amb</span> and <span class="RktSym">require</span>.
An <span class="RktSym">amb</span> with multiple expressions, <span class="RktPn">(</span><span class="RktSym">amb</span><span class="stt"> </span><span class="RktSym">exps</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span> is a form that evaluates to the value of one of its expressions.
A <span class="RktSym">require</span> with an expression, <span class="RktPn">(</span><span class="RktSym">require</span><span class="stt"> </span><span class="RktSym">exp</span><span class="RktPn">)</span>, succeeds if the expression evaluates to true (<span class="RktVal">#t</span>) and fails if it evaluates to false (<span class="RktVal">#f</span>).
If a <span class="RktSym">require</span> fails,
the evaluator should backtrack to the last <span class="RktSym">amb</span> and try to continue from there with the value of one of the &ldquo;remaining&rdquo; expressions of that <span class="RktSym">amb</span>.</div><div class="SIntrapara">For taking care of the backtracky bits, we will use a <span class="RktSym">fail</span>-continuation in addition to the <span class="RktSym">continue</span>-continuation.</div></p><h4>10.1<tt>&nbsp;</tt><a name="(part._amb-tests)"></a>Some tests</h4><p>You might want to copy them into the test module at the bottom of your Racket file.
The tests are going to fail at first. By the end of this chapter they should pass.</p><p><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-require</span><span class="hspace">&nbsp;</span><span class="RktSym">primitives</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">&lt;</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr></table></blockquote></div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-require</span><span class="hspace">&nbsp;</span><span class="RktSym">primitives</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">&gt;</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&gt;</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-exn</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktSym">exn:fail?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="RktPn">(</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&gt;</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">=</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">list</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">&gt;</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">a</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">check-equal?</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">=</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">list</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h4>10.2<tt>&nbsp;</tt><a name="(part._.Some_stuff_will_have_a_fail-parameter)"></a>Some stuff will have a <span class="RktSym">fail</span>-parameter</h4><p>The functions we use as <span class="RktSym">continue</span>-continuations, as well as all functions that have <span class="RktSym">continue</span>-parameters, should also have <span class="RktSym">fail</span>-parameters.
Like, we will change continuation-lambdas like  <span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">value</span><span class="RktPn">)</span><span class="stt"> </span><span style="font-style: italic">stuff</span><span class="RktPn">)</span> to ones like <span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">fail</span><span class="stt"> </span><span class="RktSym">value</span><span class="RktPn">)</span><span class="stt"> </span><span style="font-style: italic">stuff</span><span class="RktPn">)</span>,
and things like <span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="stt"> </span><span class="RktSym">env</span><span class="stt"> </span><span class="RktSym">continue</span><span class="stt"> </span><span class="RktSym">exp</span><span class="RktPn">)</span> to things like <span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="stt"> </span><span class="RktSym">env</span><span class="stt"> </span><span class="RktSym">continue</span><span class="stt"> </span><span class="RktSym">fail</span><span class="stt"> </span><span class="RktSym">exp</span><span class="RktPn">)</span>.
For now, the different functions will just pass their <span class="RktSym">fail</span>s along.</p><p><div class="SIntrapara">The <span class="RktSym">evaluate</span>-function should work like before. Just, it&rsquo;s <span class="RktSym">continue</span>-argument should accept a failure-continuation in addition to the result,
and it should pass some <span class="RktSym">fail</span>-argument to <span class="RktSym">eval-exp</span>:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">primitives</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fail</span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">error</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">ohno</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>10.3<tt>&nbsp;</tt><a name="(part._require)"></a><span class="RktSym">require</span></h4><p><div class="SIntrapara">In <span class="RktSym">eval-exp</span> we will add a clause:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-require</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">continue</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">fail</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr></table></blockquote></div><div class="SIntrapara">And make the function <span class="RktPn">(</span><span class="RktSym">eval-require</span><span class="stt"> </span><span class="RktSym">env</span><span class="stt"> </span><span class="RktSym">continue</span><span class="stt"> </span><span class="RktSym">fail</span><span class="stt"> </span><span class="RktSym">exp</span><span class="RktPn">)</span>.
In <span class="RktSym">eval-require</span> we will evaluate <span class="RktSym">exp</span>.</div></p><p>The continuation we pass along to <span class="RktSym">eval-exp</span> should carry on with <span class="RktSym">continue</span> if <span class="RktSym">x</span> evaluated to true,
or use <span class="RktSym">fail</span> if it evaluated to false.
The <span class="RktSym">fail</span>-continuation should not take any arguments.</p><p>The two tests that use <span class="RktSym">eval-require</span> should pass after this.</p><h4>10.4<tt>&nbsp;</tt><a name="(part._amb)"></a><span class="RktSym">amb</span></h4><p>To <span class="RktSym">eval-exp</span> we add:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktSym">exps</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-amb</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">continue</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">fail</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">exps</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr></table></blockquote><p>And we make the function <span class="RktPn">(</span><span class="RktSym">eval-amb</span><span class="stt"> </span><span class="RktSym">env</span><span class="stt"> </span><span class="RktSym">continue</span><span class="stt"> </span><span class="RktSym">fail</span><span class="stt"> </span><span class="RktSym">exps</span><span class="RktPn">)</span>.</p><p><div class="SIntrapara">In <span class="RktSym">eval-amb</span> we will <span class="RktSym">match</span> the <span class="RktSym">exps</span>-list.
If <span class="RktSym">exps</span> is empty, we <span class="RktPn">(</span><span class="RktSym">fail</span><span class="RktPn">)</span>.
If <span class="RktSym">exps</span> has at least one element, we will evaluate that expression with <span class="RktSym">eval-exp</span>:</div><div class="SIntrapara">We can pass our <span class="RktSym">continue</span>-continuation along.</div><div class="SIntrapara">But we need to make a new failure-continuation, <span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktPn">)</span><span class="stt"> </span><span style="font-style: italic">your code here</span><span class="RktPn">)</span>.
We will make it so that if anything fails later in the program, we will <span class="RktSym">eval-amb</span> with the remaining elements of the <span class="RktSym">exps</span>-list.
(When we run out of elements in <span class="RktSym">exps</span>, we will invoke our &ldquo;original&rdquo; <span class="RktSym">fail</span>-continuation, as per our first <span class="RktSym">match</span>-clause.)</div></p><h4>10.5<tt>&nbsp;</tt><a name="(part._.Btw_let_s_add_a_list-function_to_our_primitives)"></a>Btw let&rsquo;s add a <span class="RktSym">list</span>-function to our <span class="RktSym">primitives</span></h4><p>Just, it would be nice to return multiple values now, so we will add Racket&rsquo;s <span class="RktSym">list</span>-function to the <span class="RktSym">primitives</span> list.</p><h4>10.6<tt>&nbsp;</tt><a name="(part._evaluate_)"></a><span class="RktSym">evaluate*</span></h4><p>So <span class="RktSym">evaluate</span> should work mostly like before, and it will return the first solution, or throw an error if there aren&rsquo;t any.</p><p>It would be neat to have an evaluation-function that could return a list of solutions instead. So we will make one.
In <span class="RktSym">evaluate*</span>, we, uh, &ldquo;replace failure with a list of successes,&rdquo; maybe:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate*</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">primitives</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fail</span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktSym">res</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fail</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>Now we can, say, make a program for finding numbers that add up to 10:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">adds-up-to-10</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">begin</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">amb</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">6</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">require</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">=</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">10</span><span class="RktVal">)</span><span class="RktVal">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">(</span><span class="RktVal">list</span><span class="hspace">&nbsp;</span><span class="RktVal">a</span><span class="hspace">&nbsp;</span><span class="RktVal">b</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>And we can get one solution with <span class="RktPn">(</span><span class="RktSym">evaluate</span><span class="stt"> </span><span class="RktSym">adds-up-to-10</span><span class="RktPn">)</span>, or several solutions with <span class="RktPn">(</span><span class="RktSym">evaluate*</span><span class="stt"> </span><span class="RktSym">adds-up-to-10</span><span class="RktPn">)</span>.</p><h4>10.7<tt>&nbsp;</tt><a name="(part._amb-done)"></a>Done?</h4><p>Run and see that all the tests pass.</p><p>Next: Maybe <a href="It_s_puzzle_time.html" data-pltdoc="x">It&rsquo;s puzzle time</a>, or we can go <a href="Towards_zebras.html" data-pltdoc="x">Towards zebras</a>. We should be equipped for either.
We can keep using the Racket-file we&rsquo;re working with, or skip to <span class="stt">7-amb.rkt</span>..</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Booleans.html" title="backward to &quot;9 Booleans&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="It_s_puzzle_time.html" title="forward to &quot;11 It's puzzle time&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>