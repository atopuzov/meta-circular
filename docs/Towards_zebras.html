<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>12&nbsp;Towards zebras</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Make your own meta-<wbr></wbr>circular evaluator!</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Meta-circular_what_.html" class="tocviewlink" data-pltdoc="x">Meta-<wbr></wbr>circular what?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Some_Racket.html" class="tocviewlink" data-pltdoc="x">Some Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="Fixing_the_calculator.html" class="tocviewlink" data-pltdoc="x">Fixing the calculator</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Lookup_in_the_environment.html" class="tocviewlink" data-pltdoc="x">Lookup in the environment</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Definitions.html" class="tocviewlink" data-pltdoc="x">Definitions</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Functions.html" class="tocviewlink" data-pltdoc="x">Functions</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Continuation-passing_style.html" class="tocviewlink" data-pltdoc="x">Continuation-<wbr></wbr>passing style</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Refactoring_to_CPS.html" class="tocviewlink" data-pltdoc="x">Refactoring to CPS</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Booleans.html" class="tocviewlink" data-pltdoc="x">Booleans</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Ambiguousness.html" class="tocviewlink" data-pltdoc="x">Ambiguousness</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="It_s_puzzle_time.html" class="tocviewlink" data-pltdoc="x">It&rsquo;s puzzle time</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Towards zebras</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>12&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Towards zebras</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">12.1&nbsp;</td><td><a href="#%28part._.What__if_anything__is_a_zebra_%29" class="tocviewlink" data-pltdoc="x">What, if anything, is a zebra?</a></td></tr><tr><td align="right">12.2&nbsp;</td><td><a href="#%28part._.Adding_stuff_to_our_language%29" class="tocviewlink" data-pltdoc="x">Adding stuff to our language</a></td></tr><tr><td align="right">12.3&nbsp;</td><td><a href="#%28part._.Writing_a_zebra-program%29" class="tocviewlink" data-pltdoc="x">Writing a zebra-<wbr></wbr>program</a></td></tr><tr><td align="right">12.4&nbsp;</td><td><a href="#%28part._.Running_the_zebra-program%29" class="tocviewlink" data-pltdoc="x">Running the zebra-<wbr></wbr>program</a></td></tr><tr><td align="right">12.5&nbsp;</td><td><a href="#%28part._zebra-done%29" class="tocviewlink" data-pltdoc="x">Done?</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">12.1<tt>&nbsp;</tt></span><a href="#%28part._.What__if_anything__is_a_zebra_%29" class="tocsubseclink" data-pltdoc="x">What, if anything, is a zebra?</a></td></tr><tr><td><span class="tocsublinknumber">12.2<tt>&nbsp;</tt></span><a href="#%28part._.Adding_stuff_to_our_language%29" class="tocsubseclink" data-pltdoc="x">Adding stuff to our language</a></td></tr><tr><td><span class="tocsublinknumber">12.2.1<tt>&nbsp;</tt></span><a href="#%28part._.More_list_pair_functions%29" class="tocsubseclink" data-pltdoc="x">More list/<span class="mywbr"> &nbsp;</span>pair functions</a></td></tr><tr><td><span class="tocsublinknumber">12.2.2<tt>&nbsp;</tt></span><a href="#%28part._.Quotes%29" class="tocsubseclink" data-pltdoc="x">Quotes</a></td></tr><tr><td><span class="tocsublinknumber">12.2.3<tt>&nbsp;</tt></span><a href="#%28part._.Strings%29" class="tocsubseclink" data-pltdoc="x">Strings</a></td></tr><tr><td><span class="tocsublinknumber">12.2.4<tt>&nbsp;</tt></span><a href="#%28part._equal_%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">equal?</span></a></td></tr><tr><td><span class="tocsublinknumber">12.2.5<tt>&nbsp;</tt></span><a href="#%28part._.Recursive_functions%29" class="tocsubseclink" data-pltdoc="x">Recursive functions</a></td></tr><tr><td><span class="tocsublinknumber">12.3<tt>&nbsp;</tt></span><a href="#%28part._.Writing_a_zebra-program%29" class="tocsubseclink" data-pltdoc="x">Writing a zebra-<wbr></wbr>program</a></td></tr><tr><td><span class="tocsublinknumber">12.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Some_lists%29" class="tocsubseclink" data-pltdoc="x">Some lists</a></td></tr><tr><td><span class="tocsublinknumber">12.3.2<tt>&nbsp;</tt></span><a href="#%28part._.Some_helper_functions%29" class="tocsubseclink" data-pltdoc="x">Some helper functions</a></td></tr><tr><td><span class="tocsublinknumber">12.3.3<tt>&nbsp;</tt></span><a href="#%28part._.The_requirements%29" class="tocsubseclink" data-pltdoc="x">The requirements</a></td></tr><tr><td><span class="tocsublinknumber">12.3.4<tt>&nbsp;</tt></span><a href="#%28part._.Return_a_list_with_all_the_lists%29" class="tocsubseclink" data-pltdoc="x">Return a list with all the lists</a></td></tr><tr><td><span class="tocsublinknumber">12.4<tt>&nbsp;</tt></span><a href="#%28part._.Running_the_zebra-program%29" class="tocsubseclink" data-pltdoc="x">Running the zebra-<wbr></wbr>program</a></td></tr><tr><td><span class="tocsublinknumber">12.5<tt>&nbsp;</tt></span><a href="#%28part._zebra-done%29" class="tocsubseclink" data-pltdoc="x">Done?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">6.12</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="It_s_puzzle_time.html" title="backward to &quot;11 It's puzzle time&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div><h3>12<tt>&nbsp;</tt><a name="(part._.Towards_zebras)"></a>Towards zebras</h3><p>If we&rsquo;ve been through the previous part, we can keep using the same file. Or we can use <span class="stt">7-amb.rkt</span> as our starting point.</p><p>If we add a few more things to our language, we can use amb to figure out who owns the zebra.</p><h4>12.1<tt>&nbsp;</tt><a name="(part._.What__if_anything__is_a_zebra_)"></a>What, if anything, is a zebra?</h4><p><div class="SIntrapara">There exists multiple variations of the
<a href="https://en.wikipedia.org/wiki/Zebra_Puzzle">Zebra Puzzle</a>.
We will use the one we find on Wikipedia:</div><div class="SIntrapara"><ol><li><p>The Englishman lives in the red house.</p></li><li><p>There are five houses.</p></li><li><p>The Spaniard owns the dog.</p></li><li><p>Coffee is drunk in the green house.</p></li><li><p>The Ukrainian drinks tea.</p></li><li><p>The green house is immediately to the right of the ivory house.</p></li><li><p>The Old Gold smoker owns snails.</p></li><li><p>Kools are smoked in the yellow house.</p></li><li><p>Milk is drunk in the middle house.</p></li><li><p>The Norwegian lives in the first house.</p></li><li><p>The man who smokes Chesterfields lives in the house next to the man with the fox.</p></li><li><p>Kools are smoked in the house next to the house where the horse is kept.</p></li><li><p>The Lucky Strike smoker drinks orange juice.</p></li><li><p>The Japanese smokes Parliaments.</p></li><li><p>The Norwegian lives next to the blue house.</p></li></ol></div></p><p>Now, who drinks water? Who owns the zebra?</p><h4>12.2<tt>&nbsp;</tt><a name="(part._.Adding_stuff_to_our_language)"></a>Adding stuff to our language</h4><p>There&rsquo;s a few things that are necessary, or at least convenient, for solving the zebra puzzle.</p><h5>12.2.1<tt>&nbsp;</tt><a name="(part._.More_list_pair_functions)"></a>More list/pair functions</h5><p>Can add some primitives:</p><ul><li><p><span class="RktSym">cons</span> for constructing a list or pair</p></li><li><p><span class="RktSym">car</span> for getting the first element of a list or pair</p></li><li><p><span class="RktSym">cdr</span> for getting the tail of a list or the second element of a pair</p></li><li><p><span class="RktSym">null?</span> for checking if something is the empty list</p></li></ul><h5>12.2.2<tt>&nbsp;</tt><a name="(part._.Quotes)"></a>Quotes</h5><p>In Racket, e.g. <span class="RktVal">'</span><span class="RktVal">a</span> is translated to <span class="stt">(quote a)</span> by the reader.
If we want to support quotes in the language we&rsquo;re making, we can match on <span class="RktPn">(</span><span class="RktSym">list</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">quote</span><span class="stt"> </span><span class="RktSym">x</span><span class="RktPn">)</span>
and <span class="RktSym">continue</span> with the quoted syntax, <span class="RktSym">x</span>.</p><p>Quoting can be convenient for list-laterals, like <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span> and <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="stt"> </span><span class="RktVal">3</span><span class="RktVal">)</span>.
Also for for symbols, like <span class="RktVal">'</span><span class="RktVal">foo</span>.</p><h5>12.2.3<tt>&nbsp;</tt><a name="(part._.Strings)"></a>Strings</h5><p><div class="SIntrapara">Maybe we want strings, for values such as <span class="RktVal">"red"</span> and <span class="RktVal">"zebra"</span>.
(If we have added quotes to the language, we can choose to use values like <span class="RktVal">'</span><span class="RktVal">red</span> and <span class="RktVal">'</span><span class="RktVal">zebra</span> instead, and skip the strings.)</div><div class="SIntrapara">If we&rsquo;re adding strings, we want to recognize string-literals in <span class="RktSym">eval-exp</span>,
We can use <span class="RktSym">string?</span> for this, same way we use <span class="RktSym">number?</span> and <span class="RktSym">boolean?</span> for other literals.</div><div class="SIntrapara">We don&rsquo;t really need to do any fancy string-operations in order to find the zebra.
We can totally add some string-functions to our <span class="RktSym">primitives</span>,
like <span class="RktSym">string-append</span> and, say, <span class="RktSym">string-upcase</span>,
but we don&rsquo;t have to.</div></p><h5>12.2.4<tt>&nbsp;</tt><a name="(part._equal_)"></a><span class="RktSym">equal?</span></h5><p>If we add <span class="RktSym">equal?</span> to the <span class="RktSym">primitives</span> we can use it for checking if things
(e.g. strings, symbols) are equal.</p><h5>12.2.5<tt>&nbsp;</tt><a name="(part._.Recursive_functions)"></a>Recursive functions</h5><p><div class="SIntrapara">The list is a recursive data structure. We might need recursive functions.
Since our lists are Racket lists, our strings are Racket strings, and so on,
we can probably get away with writing the recursive functions in Racket and just adding them as primitives.
But it would be neat to add support for recursive functions to our language.</div><div class="SIntrapara">One way to go is to combine it with adding support for more rackety function definitions,
the ones that go.
We can add a clause to the <span class="RktSym">match</span> in <span class="RktSym">eval-sequence</span>:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><p><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">params</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">rest</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span style="font-style: italic">your code here</span><span class="RktPn">]</span></p></blockquote></div></p><p><div class="SIntrapara">Here we must extend the environment with the function definition.
To make the possibly recursive function, we make a helper-function:</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">make-named-function</span><span class="hspace">&nbsp;</span><span class="RktSym">env</span><span class="hspace">&nbsp;</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">parameters</span><span class="hspace">&nbsp;</span><span class="RktSym">body</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">continue</span><span class="hspace">&nbsp;</span><span class="RktSym">fail</span><span class="hspace">&nbsp;</span><span class="RktPn">. </span><span class="RktSym">arguments</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-style: italic">your code here</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>This should behave mostly like <span class="RktSym">make-function</span>,
only the function should add &ldquo;itself&rdquo; to the environment before adding the arguments to the environment.
It can create a copy of &ldquo;itself&rdquo; by applying <span class="RktSym">make-named-function</span> again.
(We&rsquo;re really using Racket&rsquo;s support for recursive functions to build our own support for it.)</p><h4>12.3<tt>&nbsp;</tt><a name="(part._.Writing_a_zebra-program)"></a>Writing a zebra-program</h4><p>One way to go about this:</p><h5>12.3.1<tt>&nbsp;</tt><a name="(part._.Some_lists)"></a>Some lists</h5><p>We make a list of colours, a list of nationalities, and so on.
Each element in the each list is an <span class="RktSym">amb</span>-expression with the possible values.
(We can optimize a bit: E.g. since the puzzle tells us that the norwegian lives in the first house,
we don&rsquo;t need an <span class="RktSym">amb</span> for the first element in the list of nationalities,
and we don&rsquo;t need to include norwegian as a possible value for the other elements.)</p><h5>12.3.2<tt>&nbsp;</tt><a name="(part._.Some_helper_functions)"></a>Some helper functions</h5><p>We probably want some helper functions for stuff like:</p><ul><li><p>Checking that a list contains no duplicate elements
(we won&rsquo;t allow e.g. two red houses)</p></li><li><p>Getting the index of an element in a list</p></li><li><p>Checking that one element in one list has the same index as another elemnt in another list
(for things like &ldquo;the Englishman lives in the red house&rdquo;)</p></li><li><p><span class="RktSym">abs</span> (or we can just include Racket&rsquo;s <span class="RktSym">abs</span> in the <span class="RktSym">primitives</span></p></li><li><p>Checking that one element has an index that is off by one from the index of another element in another list
(for things like &ldquo;the Norwegian lives next to the blue house&rdquo;)</p></li></ul><h5>12.3.3<tt>&nbsp;</tt><a name="(part._.The_requirements)"></a>The requirements</h5><p>With the lists and the helper functions we can specify the different requirements.</p><p>In order to make the program go faster, we should add the different requirements as soon as possible:</p><ul><li><p>After defining a list, we immediately require that it has no duplicate elements.</p></li><li><p>After defining a list, we add all the requirements that we have the necessary lists for.
Like, once we have defined a list of nationalities and a list of colours,
we will add the requirements for
&ldquo;the Englishman lives in the red house&rdquo; and &ldquo;the green house is immediately to the right of the ivory house&rdquo;
before defining more lists.</p></li></ul><h5>12.3.4<tt>&nbsp;</tt><a name="(part._.Return_a_list_with_all_the_lists)"></a>Return a list with all the lists</h5><p>Return a list with all the lists.</p><h4>12.4<tt>&nbsp;</tt><a name="(part._.Running_the_zebra-program)"></a>Running the zebra-program</h4><p>We can run the program with <span class="RktSym">evaluate</span> to find one solution,
and maybe run it with <span class="RktSym">evaluate*</span> to check that there is only one solution.</p><h4>12.5<tt>&nbsp;</tt><a name="(part._zebra-done)"></a>Done?</h4><p>OMG.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="It_s_puzzle_time.html" title="backward to &quot;11 It's puzzle time&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<span class="nonavigation">next &rarr;</span></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>