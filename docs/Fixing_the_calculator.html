<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>3&nbsp;Fixing the calculator</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9660;</a></td><td></td><td><a href="index.html" class="tocviewlink" data-pltdoc="x">Make your own meta-<wbr></wbr>circular evaluator!</a></td></tr></table></div><div class="tocviewsublisttop" style="display: block;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="Meta-circular_what_.html" class="tocviewlink" data-pltdoc="x">Meta-<wbr></wbr>circular what?</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="Some_Racket.html" class="tocviewlink" data-pltdoc="x">Some Racket</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Fixing the calculator</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="Lookup_in_the_environment.html" class="tocviewlink" data-pltdoc="x">Lookup in the environment</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="Definitions.html" class="tocviewlink" data-pltdoc="x">Definitions</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="Functions.html" class="tocviewlink" data-pltdoc="x">Functions</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="Continuation-passing_style.html" class="tocviewlink" data-pltdoc="x">Continuation-<wbr></wbr>passing style</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="Refactoring_to_CPS.html" class="tocviewlink" data-pltdoc="x">Refactoring to CPS</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="Booleans.html" class="tocviewlink" data-pltdoc="x">Booleans</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="Ambiguousness.html" class="tocviewlink" data-pltdoc="x">Ambiguousness</a></td></tr><tr><td align="right">11&nbsp;</td><td><a href="It_s_puzzle_time.html" class="tocviewlink" data-pltdoc="x">It&rsquo;s puzzle time</a></td></tr><tr><td align="right">12&nbsp;</td><td><a href="Towards_zebras.html" class="tocviewlink" data-pltdoc="x">Towards zebras</a></td></tr></table></div></div><div class="tocviewlist"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_1&quot;);">&#9658;</a></td><td>3&nbsp;</td><td><a href="" class="tocviewselflink" data-pltdoc="x">Fixing the calculator</a></td></tr></table><div class="tocviewsublistbottom" style="display: none;" id="tocview_1"><table cellspacing="0" cellpadding="0"><tr><td align="right">3.1&nbsp;</td><td><a href="#%28part._.Working_with_a_file_in_.Dr.Racket%29" class="tocviewlink" data-pltdoc="x">Working with a file in Dr<span class="mywbr"> &nbsp;</span>Racket</a></td></tr><tr><td align="right">3.2&nbsp;</td><td><a href="#%28part._.The_calculator-code%29" class="tocviewlink" data-pltdoc="x">The calculator-<wbr></wbr>code</a></td></tr><tr><td align="right">3.3&nbsp;</td><td><a href="#%28part._.Pairs__lists%29" class="tocviewlink" data-pltdoc="x">Pairs, lists</a></td></tr><tr><td align="right">3.4&nbsp;</td><td><a href="#%28part._.Making_the_test_pass%29" class="tocviewlink" data-pltdoc="x">Making the test pass</a></td></tr><tr><td align="right">3.5&nbsp;</td><td><a href="#%28part._fix-calc%29" class="tocviewlink" data-pltdoc="x">Done?</a></td></tr></table></div></div></div><div class="tocsub"><div class="tocsubtitle">On this page:</div><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Working_with_a_file_in_.Dr.Racket%29" class="tocsubseclink" data-pltdoc="x">Working with a file in Dr<span class="mywbr"> &nbsp;</span>Racket</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.The_calculator-code%29" class="tocsubseclink" data-pltdoc="x">The calculator-<wbr></wbr>code</a></td></tr><tr><td><span class="tocsublinknumber">3.2.1<tt>&nbsp;</tt></span><a href="#%28part._define%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">define</span></a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Pairs__lists%29" class="tocsubseclink" data-pltdoc="x">Pairs, lists</a></td></tr><tr><td><span class="tocsublinknumber">3.3.1<tt>&nbsp;</tt></span><a href="#%28part._.Quoting%29" class="tocsubseclink" data-pltdoc="x">Quoting</a></td></tr><tr><td><span class="tocsublinknumber">3.3.2<tt>&nbsp;</tt></span><a href="#%28part._evaluate__repl_and_.Racket_s_read_function%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">evaluate</span>, <span class="RktSym">repl</span> and Racket&rsquo;s <span class="RktSym">read</span> function</a></td></tr><tr><td><span class="tocsublinknumber">3.3.3<tt>&nbsp;</tt></span><a href="#%28part._match%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">match</span></a></td></tr><tr><td><span class="tocsublinknumber">3.3.4<tt>&nbsp;</tt></span><a href="#%28part._apply%29" class="tocsubseclink" data-pltdoc="x"><span class="RktSym">apply</span></a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#%28part._.Making_the_test_pass%29" class="tocsubseclink" data-pltdoc="x">Making the test pass</a></td></tr><tr><td><span class="tocsublinknumber">3.5<tt>&nbsp;</tt></span><a href="#%28part._fix-calc%29" class="tocsubseclink" data-pltdoc="x">Done?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="version">7.2</span></div><div class="navsettop"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Some_Racket.html" title="backward to &quot;2 Some Racket&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Lookup_in_the_environment.html" title="forward to &quot;4 Lookup in the environment&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div><h3>3<tt>&nbsp;</tt><a name="(part._.Fixing_the_calculator)"></a>Fixing the calculator</h3><p>Should open the <span class="stt">0-start-calculator.rkt</span>-file in DrRacket.</p><h4>3.1<tt>&nbsp;</tt><a name="(part._.Working_with_a_file_in_.Dr.Racket)"></a>Working with a file in DrRacket</h4><p>Click the <img src="pict.png" alt="image" width="18.0" height="24.0"/>-button, or press <span class="stt">F5</span>.
DrRacket runs the file and the window kind of splits in two.</p><ul><li><p>The bit above is the Definitions bit.
The contents of the file goes in Definitions; if we save the file it&rsquo;s the stuff in Definitions that will be saved.</p></li><li><p>The bit below is the Interactions bit.
This is like a REPL. We can write Racket expressions here and have them evaluated.
The Definitions are made available for Interactions whenever we Run the file.</p></li></ul><p>There&rsquo;s a failing test. We&rsquo;ll get back to that.</p><p>For now, try to run some expressions in Interactions. Maybe some of these:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></p></blockquote><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">evaluate</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktPn">)</span></p></blockquote><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">repl</span><span class="RktPn">)</span></p></blockquote><h4>3.2<tt>&nbsp;</tt><a name="(part._.The_calculator-code)"></a>The calculator-code</h4><p>There&rsquo;s some stuff going on...</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">match</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">?</span><span class="hspace">&nbsp;</span><span class="RktSym">number?</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">apply</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">apply</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">*</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">apply</span><span class="hspace">&nbsp;</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">/</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">apply</span><span class="hspace">&nbsp;</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">map</span><span class="hspace">&nbsp;</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">error</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">wat</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">~a</span><span class="hspace">&nbsp;</span><span class="RktSym">exp</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eval-exp</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">repl</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"&gt; "</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">read</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unless</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">eof-object?</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">output</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">evaluate</span><span class="hspace">&nbsp;</span><span class="RktSym">input</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">printf</span><span class="hspace">&nbsp;</span><span class="RktVal">"~a~n"</span><span class="hspace">&nbsp;</span><span class="RktSym">output</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">repl</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><h5>3.2.1<tt>&nbsp;</tt><a name="(part._define)"></a><span class="RktSym">define</span></h5><p>The first <a href="https://docs.racket-lang.org/reference/define.html"><span class="RktSym">define</span></a>-form defines a function called <span class="RktSym">eval-exp</span> that takes one argument, <span class="RktSym">exp</span>.
For now, the <span class="RktSym">eval-exp</span>-function is the most important piece of code. It is for evaluating an expression and returning the result.</p><h4>3.3<tt>&nbsp;</tt><a name="(part._.Pairs__lists)"></a>Pairs, lists</h4><p>We can create a pair with <span class="RktVal">"cons"</span>:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></p></blockquote><p>Sometimes we draw pairs like this:</p><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_2.png" alt="image" width="81" height="65"/></p><p>We draw the second element to the right like that because we like making lists by linking together pairs.</p><p><div class="SIntrapara">A list is
</div><div class="SIntrapara"><ul><li><p>either the special "empty list" value, <span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span></p></li><li><p>or a pair where the first element is the first element in the list and the second element is the rest of the list.</p></li></ul></div></p><p>So a list with the numbers <span class="RktVal">1</span>, <span class="RktVal">2</span> and <span class="RktVal">3</span> we can build one with <span class="RktSym">cons</span>, or we can use the more convenient function <span class="RktSym">list</span>.
All of these are pretty equivalent:</p><ul><li><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></li><li><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></p></blockquote></li><li><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></li><li><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">cons</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote></li></ul><p>So like:</p><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_3.png" alt="image" width="270" height="65"/></p><h5>3.3.1<tt>&nbsp;</tt><a name="(part._.Quoting)"></a>Quoting</h5><p>The following is a regular Racket-expresssion:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></p></blockquote><p>It is the application of the function <span class="RktSym">+</span> to the arguments <span class="RktVal">1</span> and <span class="RktVal">2</span>.</p><p>We can <a href="https://docs.racket-lang.org/reference/quote.html">&ldquo;quote&rdquo;</a> a term:</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">)</span></p></blockquote><p>This is not a function application. It evaluates to a list with three elements:
The symbol <span class="RktVal">'</span><span class="RktVal">+</span>, the number <span class="RktVal">1</span>, and the number <span class="RktVal">2</span>.</p><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_4.png" alt="image" width="211" height="65"/></p><p>So we can &ldquo;quote&rdquo; a term in order to get the syntax of the term as a data object.
Try out the following expressions in the REPL, and notice the differences.</p><p><span class="RktPn">(</span><span class="RktSym">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span></p><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span></p><p><span class="RktPn">(</span><span class="RktSym">list</span><span class="stt"> </span><span class="RktSym">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span></p><p><span class="RktPn">(</span><span class="RktSym">list</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span></p><p>If you would like to check if two values are equal to each other, the function <span class="RktSym">equal?</span> is handy.</p><p>The quoted term can be pretty arbitrary and nested and stuff.</p><blockquote class="SCodeFlow"><p><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktVal">8</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktVal">)</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal"><span class="nobreak">-</span></span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktVal">)</span></p></blockquote><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_5.png" alt="image" width="694" height="139"/></p><p>As the quoted terms become more complicated, the visualisations with the boxes and the lines and such becomes, uh, a bit much.
We are going to think of lists like these as programs that our evaluator can evaluate. Programs are kind of trees:</p><p><img style="vertical-align: 0px; margin: -3px -3px -3px -3px;" src="pict_6.png" alt="image" width="166" height="198"/></p><h5>3.3.2<tt>&nbsp;</tt><a name="(part._evaluate__repl_and_.Racket_s_read_function)"></a><span class="RktSym">evaluate</span>, <span class="RktSym">repl</span> and Racket&rsquo;s <span class="RktSym">read</span> function</h5><p>The programs we will evaluate with our evaluator are data objects like the ones we get by quoting Racket terms.
So we can write terms that are like regular Racket terms, quote them and pass them to our evaluator:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">evaluate</span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktVal">)</span><span class="RktPn">)</span></p></blockquote><p><span class="RktPn">(</span><span class="RktSym">equal?</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktVal">)</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">list</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">+</span><span class="stt"> </span><span class="RktVal">1</span><span class="stt"> </span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></p><p>The <span class="RktSym">repl</span>-function is a Read-Eval-Print-Loop.
It uses the <span class="RktSym">read</span>-function to read a Racket term.
<span class="RktSym">read</span> reads a Racket term and returns a data object, same as we would get if that term was quoted in a regular Racket program.
<span class="RktSym">repl</span> then <span class="RktSym">evaluate</span>s, <span class="RktSym">printf</span>s the result, and, by calling itself recursively, loops.</p><p>So we can use the <span class="RktSym">repl</span>-function to get a repl for the language we are making.
Nice to have, can be fun to play around with.
(But we will usually call <span class="RktSym">evaluate</span> directly, with quoted Racket terms, when testing the evaluator during the workshop.)</p><h5>3.3.3<tt>&nbsp;</tt><a name="(part._match)"></a><span class="RktSym">match</span></h5><p>Inside the <span class="RktSym">eval-exp</span>-function there is a <a href="https://docs.racket-lang.org/reference/match.html"><span class="RktSym">match</span></a>-form.
<span class="RktSym">match</span> is used for pattern matching.
It matches <span class="RktSym">exp</span> against a series of patterns, and evaluates some &ldquo;body&rdquo;-code for the first pattern that matches.
Each &ldquo;clause&rdquo; consists of a pattern and some &ldquo;body&rdquo;-code. So:</p><ul><li><p>The pattern <span class="RktPn">(</span><span class="RktSym">?</span><span class="stt"> </span><span class="RktSym">number?</span><span class="RktPn">)</span> matches if <span class="RktSym">exp</span> is a number (if the <span class="RktSym">number?</span>-function returns true when applied to <span class="RktSym">exp</span>.
If it matches, <span class="RktSym">eval-exp</span> will return (the number) <span class="RktSym">exp</span>.</p></li><li><p>The pattern <span class="RktPn">(</span><span class="RktSym">list</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal">+</span><span class="stt"> </span><span class="RktSym">args</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span> matches if <span class="RktSym">exp</span> is a list where the first element is the symbol <span class="RktVal">'</span><span class="RktVal">+</span>.
If it matches, <span class="RktPn">(</span><span class="RktSym">apply</span><span class="stt"> </span><span class="RktSym">+</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">map</span><span class="stt"> </span><span class="RktSym">eval-exp</span><span class="stt"> </span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span>, with <span class="RktSym">args</span> bound to the rest of the <span class="RktSym">exp</span>-list, will be evaluated.
<span class="RktSym">eval-exp</span> will return result.</p></li><li><p>The pattern <span class="RktPn">(</span><span class="RktSym">list</span><span class="stt"> </span><span class="RktVal">'</span><span class="RktVal"><span class="nobreak">-</span></span><span class="stt"> </span><span class="RktSym">args</span><span class="stt"> </span><span class="RktSym">...</span><span class="RktPn">)</span> matches if the <span class="RktSym">exp</span> is a list where the first element is the symbol <span class="RktVal">'</span><span class="RktVal"><span class="nobreak">-</span></span>.
If it matches, <span class="RktPn">(</span><span class="RktSym">apply</span><span class="stt"> </span><span class="RktSym"><span class="nobreak">-</span></span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">map</span><span class="stt"> </span><span class="RktSym">eval-exp</span><span class="stt"> </span><span class="RktSym">args</span><span class="RktPn">)</span><span class="RktPn">)</span>, with <span class="RktSym">args</span> bound to the rest of the <span class="RktSym">exp</span>-list, will be evaluated.
<span class="RktSym">eval-exp</span> will return result.</p></li><li><p>And so on.</p></li><li><p><span class="RktSym">_</span> matches whatever. If none of the patterns above match, this one will, and we will throw an error.</p></li></ul><h5>3.3.4<tt>&nbsp;</tt><a name="(part._apply)"></a><span class="RktSym">apply</span></h5><p>In most of the pattern matching clauses, we use the <a href="https://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29"><span class="RktSym">apply</span></a>-function.
<span class="RktSym">apply</span> is a function application function.
If a function takes several arguments, and we have the arguments we want to apply it to in a list, we can use <span class="RktSym">apply</span>.</p><p>Like, normally we apply the <span class="RktSym">+</span>-function like so:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span></p></blockquote><p>If we have a list <span class="RktSym">lst</span> with numbers:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">define</span><span class="hspace">&nbsp;</span><span class="RktSym">lst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">list</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></p></blockquote><p>Then we cannot apply <span class="RktSym">+</span> directly to the <span class="RktSym">lst</span>-list.
<span class="RktSym">+</span> can be applied to severl number-arguments, not one list-with-several-numbers-argument.
But we can use <span class="RktSym">apply</span>:</p><blockquote class="SCodeFlow"><p><span class="RktPn">(</span><span class="RktSym">apply</span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">lst</span><span class="RktPn">)</span></p></blockquote><h4>3.4<tt>&nbsp;</tt><a name="(part._.Making_the_test_pass)"></a>Making the test pass</h4><p>Lets&rsquo;s make the failing test pass:</p><ul><li><p>Quickest way to get back to the failure is to run (<span class="stt">F5</span>) the file again.</p></li><li><p>DrRacket should highlight the failing test in the definitions window, or we can click on the <img src="pict_7.png" alt="image" width="24.0" height="24.0"/> in the REPL to highlight it again.</p></li><li><p>We can stare at the failing test and at the <span class="RktSym">eval-exp</span>-code for a little while.</p></li><li><p>And then fix.</p></li></ul><h4>3.5<tt>&nbsp;</tt><a name="(part._fix-calc)"></a>Done?</h4><p>Next is <a href="Lookup_in_the_environment.html" data-pltdoc="x">Lookup in the environment</a>.
We can keep using the Racket-file we&rsquo;re working with, or skip to <span class="stt">1-fixed-calculator.rkt</span>.</p><div class="navsetbottom"><span class="navleft"><div class="nosearchform"></div>&nbsp;&nbsp;</span><span class="navright">&nbsp;&nbsp;<a href="Some_Racket.html" title="backward to &quot;2 Some Racket&quot;" data-pltdoc="x">&larr; prev</a>&nbsp;&nbsp;<a href="index.html" title="up to &quot;Make your own meta-circular evaluator!&quot;" data-pltdoc="x">up</a>&nbsp;&nbsp;<a href="Lookup_in_the_environment.html" title="forward to &quot;4 Lookup in the environment&quot;" data-pltdoc="x">next &rarr;</a></span>&nbsp;</div></div></div><div id="contextindicator">&nbsp;</div></body></html>